@using QRCoder
@using System.Drawing

@if (!string.IsNullOrEmpty(Data))
{
    <div style="@ContainerStyle">
        <img src="@_qrCodeImage" alt="QR Code" style="@ImageStyle" />
    </div>
}

@code {
    [Parameter]
    public string? Data { get; set; }

    [Parameter]
    public int PixelsPerModule { get; set; } = 10;

    [Parameter]
    public string ContainerStyle { get; set; } = "";

    [Parameter]
    public string ImageStyle { get; set; } = "";

    private string _qrCodeImage = string.Empty;

    protected override void OnParametersSet()
    {
        if (!string.IsNullOrEmpty(Data))
        {
            GenerateQRCode();
        }
    }

    private void GenerateQRCode()
    {
        if (string.IsNullOrEmpty(Data))
            return;

        using var qrGenerator = new QRCodeGenerator();
        using var qrCodeData = qrGenerator.CreateQrCode(Data, QRCodeGenerator.ECCLevel.Q);
        using var qrCode = new PngByteQRCode(qrCodeData);
        var qrCodeBytes = qrCode.GetGraphic(PixelsPerModule);
        _qrCodeImage = $"data:image/png;base64,{Convert.ToBase64String(qrCodeBytes)}";
    }
}
